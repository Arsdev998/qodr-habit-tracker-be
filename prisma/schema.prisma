generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          Int          @id @default(autoincrement())
  name        String       @db.VarChar(50) 
  fullname    String       @db.VarChar(50)  @default("")
  email       String       @db.VarChar(50)  @default("")
  password    String
  motivation  String       @default("")
  joinDate    String
  role        Role         @default(SANTRI)
  habit       Habit[]
  habits      HabitStatus[] 
  warnings    Warning[]
  murajaah    Murajaah[]
  ziyadah     Ziyadah[]
  tilawah     Tilawah[]
  notifications Notification[]
  createdAt   DateTime      @default(now())
  updateAt   DateTime       @updatedAt
}

enum Role {
  SUPERADMIN
  ADMIN
  SANTRI
}


model Month {
  id          Int          @id @default(autoincrement())
  name        String       @db.VarChar(50)  
  year        Int           
  habitStatuses HabitStatus[] 
  days        Day[]
  murajaah    Murajaah[]
  ziyadah     Ziyadah[]
  tilawah     Tilawah[]
  createdAt   DateTime      @default(now())
  updateAt   DateTime       @updatedAt
}

model Day{
  id         Int  @id @default(autoincrement())
  date       Int
  monthId    Int
  month      Month  @relation(fields: [monthId],references: [id],onDelete: Cascade)
  habitStatuses HabitStatus[]
  createdAt   DateTime      @default(now())
  updateAt   DateTime       @updatedAt
}

model Habit {
  id          Int          @id @default(autoincrement())
  title       String       @db.VarChar(50) 
  habitStatuses HabitStatus[] 
  maxDays     Int?  
  userId      Int?
  user     User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime      @default(now())
  updateAt   DateTime       @updatedAt
}

model HabitStatus {
  id          Int      @id @default(autoincrement())
  userId      Int      
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  habitId     Int      
  habit       Habit    @relation(fields: [habitId], references: [id],onDelete: Cascade)
  monthId     Int      
  month       Month    @relation(fields: [monthId], references: [id],onDelete: Cascade)
  dayId       Int      
  day         Day      @relation(fields: [dayId], references: [id],onDelete: Cascade)
  status      Boolean  
  comments    String?  
  createdAt   DateTime      @default(now())
  updateAt   DateTime       @updatedAt
}



model Murajaah {
  id          Int          @id @default(autoincrement())
  surah       String       @db.VarChar(55)      // Nama surah yang dihafal atau dibaca
  date        DateTime     
  userId      Int
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  monthId     Int
  month       Month         @relation(fields: [monthId], references: [id])
  createdAt   DateTime      @default(now())
  updateAt   DateTime       @updatedAt
}

model Ziyadah {
  id          Int          @id @default(autoincrement())
  surah       String       @db.VarChar(50) 
  date        DateTime
  userId      Int
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  monthId     Int
  month       Month         @relation(fields: [monthId], references: [id])
  createdAt   DateTime      @default(now())
  updateAt   DateTime       @updatedAt
}

model Tilawah {
  id          Int          @id @default(autoincrement())
  surah       String       @db.VarChar(50) 
  lembar      Int           
  userId      Int
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  monthId     Int
  month       Month         @relation(fields: [monthId], references: [id])
  createdAt   DateTime      @default(now())
  updateAt   DateTime       @updatedAt
}

model Warning {
  id          Int          @id @default(autoincrement())
  message     String       
  type        String        // Jenis peringatan: 'green', 'yellow', 'red'
  userId      Int
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime      @default(now())
}

model Notification {
  id          Int          @id @default(autoincrement())
  userId      Int
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  message     String        @db.Text
  rawMessage  String?       @db.Text   
  status      Boolean       
  createdAt   DateTime     @default(now())
}

model Evaluation {
  id          Int         @id @default(autoincrement())
  about       String      @db.VarChar(100)
  problem     String      @db.VarChar(500)
  identifier  String?      
  createdAt   DateTime    @default(now())
}
